<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>DARIZA SCADA IOT </title>

<style>
#fullscreenBtn {
  position: fixed;
  top: 15px;
  right: 15px;
  background: transparent;   /* üëà sin fondo */
  color: #0f62fe;            /* üëà solo icono azul */
  border: none;
  font-size: 2rem;           /* üëà icono m√°s bonito */
  cursor: pointer;
  z-index: 9999;
  display: block;
}

body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #fff;
  color: #333;
  height: 100vh;
  overflow: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* ========= LOGIN ========= */
#loginScreen {
  text-align: center;
}

#loginBox {
  padding: 20px;
  border: 1px solid #ccc;
  border-radius: 12px;
  width: 320px;
  background: #fafafa;
  box-shadow: 0 0 12px rgba(0,0,0,0.15);
  display: flex;
  flex-direction: column;
  align-items: center;
}

#loginLogo {
  width: 320px;
  height: 230px;
  margin-bottom: 15px;
}

#loginLogo img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

#loginBox input {
  width: 100%;
  padding: 10px;
  margin-top: 12px;
  font-size: 1em;
  border-radius: 8px;
  border: 1px solid #bbb;
}

#loginBox button {
  width: 100%;
  margin-top: 18px;
  padding: 10px;
  background: #22a6b3;
  color: white;
  font-size: 1.1em;
  cursor: pointer;
  border: none;
  border-radius: 8px;
  transition: 0.2s;
}
#loginBox button:hover { background: #0984e3; }

/* ========= PANTALLAS ========= */
.screen {
  display: none;
  width: 100%;
  height: 100vh;
  padding-bottom: 90px; /* espacio para el men√∫ */
  box-sizing: border-box;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

/* ========= PANTALLA PRINCIPAL ========= */
#mainScreen {
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
  width: 100%;
  padding-bottom: 90px;
  box-sizing: border-box;
}

#hmiContainer {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100%;
  width: 100%;
}

#logoContainer {
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  padding-top: 20px;
}

#logoContainer img {
  width: 80%;
  height: auto;
  object-fit: contain;
}

/* ========= MEN√ö FIJO ========== */
#navMenu {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: transparent;   /* üëà ahora es transparente */
  padding: 8px;
  display: flex;
  justify-content: center;
  gap: 25px;
  box-sizing: border-box; 
  visibility: hidden;
}

#navMenu button {
  width: calc(19% - 25px); /* 5 botones ‚Üí 20% cada uno */
  padding: 14px 0;
  background: #0f62fe;
  color: white;
  border: none;
  border-radius: 3px;
  font-size: 1.6em;
  font-weight: bold;
  cursor: pointer;
}

#navMenu button:hover {
  background: #3d7dff;
}
/* Botones abajo del tanque */
.tanqueBox button {
  display: block;
  margin-top: 5px;
  width: 90%;  /* ocupa casi todo el ancho del tanque */
}

#esquemaContainer {
  position: relative;
  width: 95vw;
  max-width: 1500px;
  height: 92vh;
  margin: 0 auto;
}

/* Tanques posicionados relativos al contenedor del esquema */
#tanque1Img, #tanque2Img, #tanque3Img {
  position: absolute;
  display: none;
}

/* PC */
#tanque1Img { top: 6.6%; left: 10%; width: 165px; height: 288.5px; }
#tanque2Img { top: 6.6%; left: 24.8%; width: 165px; height: 288.5px; }
#tanque3Img { top: 6.6%; left: 80%; width: 165px; height: 288.5px; }

/* M√ìVIL */
@media screen and (max-width: 768px) {
  #tanque1Img { top: 15%; left: 10%; width: 14%; height: 36%; }
  #tanque2Img { top: 15%; left: 20%; width: 14%; height: 36%; }
  #tanque3Img { top: 15%; left: 86%; width: 14%; height: 36%; }
}

#esquemaImg {
  width: 95vw;
  max-width: 1500px;
  height: 92vh; /* ‚¨ÖÔ∏è M√ÅS ALTO QUE TU PANTALLA */
  object-fit: fill; /* ‚¨ÖÔ∏è estira sin respetar proporci√≥n */
}
/* === CUADROS CELESTES DIAGN√ìSTICO === */
.diagnosticoBox {
  width: 40vw;                  /* ancho relativo */
  height: 73vh;                 /* alto relativo */
  background: #b5dcff;          /* celeste estilo HMI */
  border: 1px solid #000;       /* borde negro */
  border-radius: 3px;
  box-shadow: 0 0 10px rgba(0,0,0,0.25);
  padding: 15px;
  margin-top: 2.4%;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.diagnosticoTitulo {
  font-size: 2.2vw;
  color: #0040ff;
  font-weight: bold;
  margin-top: 3px;   /* üëà SUBE EL TEXTO */
}
/* Rect√°ngulo flotante y responsive */
.rectangulo {
    width: 7%;                   
    aspect-ratio: 1.5/1;   
    background-color: red;    
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 2%;     
    font-size: 2vw;        
    font-weight: bold;
    transition: 0.3s ease;  
    position: absolute;     
}
/* RESPONSIVO PARA M√ìVIL */
@media (max-width: 768px) {
  #esquemaImg {
    width: 100vw;      /* ocupa casi toda la pantalla */
    height: 88vh; /* ‚¨ÖÔ∏è M√ÅS ALTO QUE TU PANTALLA */
    max-width: none;
  }
  #esquemaContainer {
    padding-top: 5%;
  }
  #navMenu button {
    font-size: 1em;
    padding: 10px 0;
  }
  .diagnosticoBox {
    width: 35vw;   /* ocupa m√°s ancho en m√≥vil */
    height: 70vh;  /* altura segura */
    margin-top: 12vh;
  }

  .diagnosticoTitulo {
    font-size: 4vw; /* ajusta tama√±o texto */
  }

  .rectangulo {
    width: 6vw; /* 10% del ancho de la pantalla */
    height: 10vh;
    font-size: 2.5vw;
  }
}

.textoProcesoBox {
  position: absolute;

  display: flex;
  justify-content: center;    /* centra horizontal */
  align-items: center;        /* centra vertical */

  padding: 0.5vw 1vw;

  background: #0f62fe;
  border: 0.15vw solid #0a4ec4;
  border-radius: 0.3vw;

  box-shadow: 0 0 0.6vw rgba(0,0,0,0.25);

  white-space: normal;        /* üëà ahora s√≠ permite multilinea */
  text-align: center;         /* üëà centra cada l√≠nea */
}
.textoProceso {
  font-size: 1.2vw;
  color: white;
  font-weight: bold;
  margin: 0;
}
/* === CUADRO ESPECIAL M√ÅS GRANDE (SOLO PARA PARAMETROS) === */
.textoProcesoBoxGrande {
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;

  padding: 0.5vw 1vw;

  background: #06E3E8;
  border: 1px solid #000000;
  border-radius: 0.5vw;

  box-shadow: 0 0 1vw rgba(0,0,0,0.25);

  white-space: normal;
  text-align: center;

  width: 34vw;   /* üëà M√ÅS ANCHO */
  height: 6vw;   /* üëà M√ÅS ALTO */
}

.textoProcesoGrande {
  font-size: 2vw;  /* üëà LETRA M√ÅS GRANDE */
  color: black;
  font-weight: bold;
  margin: 0;
  line-height: 1.2;
}

.textoProcesoBox2 {
  position: absolute;
  display: flex;
  flex-direction: column;
  justify-content: center;   /* üëà CENTRA verticalmente */
  align-items: flex-start;

  width: 28vw;
  height: 2.4vw;             /* üëà un poquito m√°s alto para que respire */

  padding: 12px 10px;        /* üëà m√°s espacio uniforme arriba/abajo */
  background: #C2F1FA;
  border: 1px solid #000000;
  border-radius: 3px;
  box-shadow: 0 0 6px rgba(0,0,0,0.25);
}


.textoProceso2 {
  font-size: 1.2vw;
  color: black;
  text-align: left;
  font-weight: bold;
  margin: 0;

  display: flex;
  justify-content: space-between; 
  width: 96%; /* Ajusta la separaci√≥n autom√°ticamente */
}
/* ===== CUADRO TRANSPARENTE SOLO TEXTO ===== */
.textoProcesoBoxTransparente {
  position: absolute;
  display: flex;
  justify-content: left;
  align-items: center;

  padding: 0.5vw 1vw;

  background: transparent;      /* SIN FONDO */
  border: none;                 /* SIN BORDE */
  box-shadow: none;             /* SIN SOMBRA */

  white-space: normal;
  text-align: left;

  width: 34vw;                  /* igual que textoProcesoBoxGrande */
  height: 6vw;                  /* igual que textoProcesoBoxGrande */
}

.textoProcesoTransparente {
  font-size: 2vw;               /* igual que textoProcesoGrande */
  color: black;                 /* color del texto */
  font-weight: bold;
  margin: 0;
  line-height: 1.2;
}
/* Quitar flechas de los inputs type=number */
input::-webkit-outer-spin-button,
input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}
input[type=number] {
    -moz-appearance: textfield; /* Firefox */
}

</style>
</head>
<body>
<button id="fullscreenBtn" onclick="activarPantallaCompleta()">‚õ∂</button>
<!-- ========== LOGIN ========== -->
<div id="loginScreen">
  <div id="loginBox">
    <div id="loginLogo">
      <img src="logo.jpg" alt="Logo" />
    </div>

    <h2>Ingresar</h2>
    <input id="usuario" type="text" placeholder="Usuario">
    <input id="password" type="password" placeholder="Contrase√±a">
    <button onclick="login()">Entrar</button>
    <p id="mensaje" style="color:red; margin-top:10px;"></p>
  </div>
</div>

<!-- ========== PANTALLA PRINCIPAL ========== -->
<div id="mainScreen" class="screen">
  <div id="hmiContainer">
    <div id="logoContainer">
      <img src="logo.jpg" alt="LOGO">
    </div>
  </div>
</div>

<!-- ========== OTRAS PANTALLAS ========== -->

<div id="procesoScreen" class="screen">
  <!-- Contenedor relativo del esquema -->
  <div id="esquemaContainer">
      <img src="esquema.PNG" id="esquemaImg">

      <!-- TANQUES dentro del mismo contenedor -->
      <img id="tanque1Img" src="lleno.PNG" style="display:none; position:absolute;">
      <img id="tanque2Img" src="lleno.PNG" style="display:none; position:absolute;">
      <img id="tanque3Img" src="lleno.PNG" style="display:none; position:absolute;">
  </div>

  <!-- CUADROS DE TEXTO -->
  <div class="textoProcesoBox" style="top: 43%; left: 24%;">
      <p class="textoProceso">MODO DE TRABAJO</p>
  </div>

  <div class="textoProcesoBox" style="top: 43%; left: 76%;">
      <p class="textoProceso">BOMBA DE SUMINISTRO</p>
  </div>
</div>


<div id="monitoreoScreen" class="screen">
  <!-- TITULOS DE VARIADORES -->
  <div class="textoProcesoBox" style="top: 3%; left: 16%;">
     <p class="textoProceso">VARIADOR DE BOMBA<br>SUMERGIBLE</p>
  </div>

  <div class="textoProcesoBox" style="top: 3%; left: 67.9%;">
     <p class="textoProceso">VARIADOR DE BOMBAS<br>DE SUMINISTRO</p>
  </div>

  <!-- PRIMER BLOQUE DE MONITOREO -->
  <div class="textoProcesoBox2" style="top: 14%; left: 8.8%;">
     <p class="textoProceso2">
       <span>ESTADO:</span>
       <span id="estadoValor">DESCONOCIDO</span>
     </p>
  </div>

  <div class="textoProcesoBox2" style="top: 26%; left: 8.8%;">
    <p class="textoProceso2">
      <span>POTENCIA:</span>
      <span id="potenciaValor">KW</span>
    </p>
  </div>

  <div class="textoProcesoBox2" style="top: 38%; left: 8.8%;">
    <p class="textoProceso2">
      <span>CORRIENTE:</span>
      <span id="corrienteValor">A</span>
    </p>
  </div>

  <div class="textoProcesoBox2" style="top: 50%; left: 8.8%;">
    <p class="textoProceso2">
      <span>VOLTAJE:</span>
      <span id="voltajeValor">V</span>
    </p>
  </div>

  <div class="textoProcesoBox2" style="top: 62%; left: 8.8%;">
    <p class="textoProceso2">
      <span>FRECUENCIA:</span>
      <span id="frecuenciaValor">HZ</span>
    </p>
  </div>

  <!-- SEGUNDO BLOQUE DE MONITOREO (SI QUIERES) -->
  <div class="textoProcesoBox2" style="top: 14%; left: 60.8%;">
     <p class="textoProceso2">
       <span>ESTADO:</span>
       <span id="estadoValor2">DESCONOCIDO</span>
     </p>
  </div>

  <div class="textoProcesoBox2" style="top: 26%; left: 60.8%;">
    <p class="textoProceso2">
      <span>POTENCIA:</span>
      <span id="potenciaValor2">%</span>
    </p>
  </div>

  <div class="textoProcesoBox2" style="top: 38%; left: 60.8%;">
    <p class="textoProceso2">
      <span>CORRIENTE:</span>
      <span id="corrienteValor2">A</span>
    </p>
  </div>

  <div class="textoProcesoBox2" style="top: 50%; left: 60.8%;">
    <p class="textoProceso2">
      <span>VOLTAJE:</span>
      <span id="voltajeValor2">V</span>
    </p>
  </div>

  <div class="textoProcesoBox2" style="top: 62%; left: 60.8%;">
    <p class="textoProceso2">
      <span>FRECUENCIA:</span>
      <span id="frecuenciaValor2">Hz</span>
    </p>
  </div>
  <div class="textoProcesoBox2" style="top: 74%; left: 8.8%; background: yellow; border: 1px solid #000;">
   <input id="inputFreqProceso" type="number" min="0" max="60" step="0.01"
           style="width: 100%; height: 100%; font-size:1.2vw; font-weight:bold; text-align:center; border:none; background: yellow; -moz-appearance:textfield; -webkit-appearance:none;">
  </div>
  <div class="textoProcesoBox2" style="top: 74%; left: 60.8%; background: yellow; border: 1px solid #000;">
   <input id="inputFreq2Proceso" type="number" min="0" max="60" step="0.01"
           style="width: 100%; height: 100%; font-size:1.2vw; font-weight:bold; text-align:center; border:none; background: yellow; -moz-appearance:textfield; -webkit-appearance:none;">
  </div>
  <div class="textoProcesoBoxTransparente" style="top: 73%; left: 32%;">
     <p class="textoProcesoTransparente">Hz</p>
   </div>
  <div class="textoProcesoBoxTransparente" style="top: 73%; left: 82%;">
     <p class="textoProcesoTransparente">Hz</p>
   </div>
</div>

<div id="parametrosScreen" class="screen">
  <div class="textoProcesoBoxGrande" style="top: 15%; left: 20%;">
       <p class="textoProcesoGrande">RETARDO DE TOLERANCIA<br>DE GARANT√çA DE PRESI√ìN</p>
  </div>
  <div class="textoProcesoBoxGrande" style="top: 40%; left: 20%;">
       <p class="textoProcesoGrande">PRESI√ìN M√çNIMA DE<br>SUMINISTRO</p>
  </div>
  <div class="textoProcesoBoxGrande" style="top: 65%; left: 20%;">
       <p class="textoProcesoGrande">CANTIDAD DE REINTENTOS<br>POR FALTA DE PRESI√ìN</p>
  </div>
  <div class="textoProcesoBoxGrande" style="top: 15%; left: 60%; background: #FFFF00; width: 12vw;">
      <input id="inputRetardoPresion" type="number" min="0.0" max="10.0" step="0.1"
             style="width: 100%; height: 100%; font-size:2vw; font-weight:bold; text-align:center; border:none; background:#FFFF00; -moz-appearance:textfield; -webkit-appearance:none;">
  </div>

  <div class="textoProcesoBoxGrande" style="top: 40%; left: 60%; background: #FFFF00; width: 12vw;">
      <input id="inputPresionMinima" type="number" min="0.00" max="10.00" step="0.01"
             style="width: 100%; height: 100%; font-size:2vw; font-weight:bold; text-align:center; border:none; background:#FFFF00; -moz-appearance:textfield; -webkit-appearance:none;">
  </div>

  <div class="textoProcesoBoxGrande" style="top: 65%; left: 60%; background: #FFFF00; width: 12vw;">
      <input id="inputReintentos" type="number" min="1" max="10" step="1"
             style="width: 100%; height: 100%; font-size:2vw; font-weight:bold; text-align:center; border:none; background:#FFFF00; -moz-appearance:textfield; -webkit-appearance:none;">
  </div>
  <div class="textoProcesoBoxTransparente" style="top: 15.2%; left: 69%;">
     <p class="textoProcesoTransparente">s</p>
   </div>
  <div class="textoProcesoBoxTransparente" style="top: 40.2%; left: 69%;">
     <p class="textoProcesoTransparente">bar</p>
   </div>
</div>

<div id="diagnosticoScreen" class="screen" 
     style="flex-direction: row; justify-content: center; gap: 4vw;">

  <div class="diagnosticoBox">
     <p class="diagnosticoTitulo">ENTRADAS</p>
     <div id="rect1" class="rectangulo" style="top: 19%; left: 10%;">X0</div>
     <div id="rect2" class="rectangulo" style="top: 36%; left: 10%;">X1</div>
     <div id="rect3" class="rectangulo" style="top: 53%; left: 10%;">X2</div>
     <div id="rect4" class="rectangulo" style="top: 70%; left: 10%;">X3</div>
     <div class="textoProcesoBoxTransparente" style="top: 17%; left: 17.3%;">
       <p class="textoProcesoTransparente">BOYA 1</p>
     </div>
     <div class="textoProcesoBoxTransparente" style="top: 34%; left: 17.3%;">
       <p class="textoProcesoTransparente">BOYA 2</p>
     </div>
     <div class="textoProcesoBoxTransparente" style="top: 51%; left: 17.3%;">
       <p class="textoProcesoTransparente">SOLICITUD (BOYA 3)</p>
     </div>
     <div class="textoProcesoBoxTransparente" style="top: 68%; left: 17.3%;">
       <p class="textoProcesoTransparente">PARADA DE EMERGENCIA</p>
     </div>
  </div>

  <div class="diagnosticoBox">
     <p class="diagnosticoTitulo">SALIDAS</p>
     <div id="rect5" class="rectangulo" style="top: 19%; left: 53%;">Y0</div>
     <div id="rect6" class="rectangulo" style="top: 36%; left: 53%;">Y1</div>
     <div class="textoProcesoBoxTransparente" style="top: 17%; left: 60%;">
       <p class="textoProcesoTransparente">BOMBA IZQUIERDA</p>
     </div>
     <div class="textoProcesoBoxTransparente" style="top: 34%; left: 60%;">
       <p class="textoProcesoTransparente">BOMBA DERECHA</p>
     </div>
  </div>

</div>


<!-- ========== MEN√ö FIJO ========== -->
<div id="navMenu">
  <button onclick="showScreen('mainScreen')">PRINCIPAL</button>
  <button onclick="showScreen('procesoScreen')">PROCESO</button>
  <button onclick="showScreen('monitoreoScreen')">MONITOREO</button>
  <button onclick="showScreen('parametrosScreen')">PARAMETROS</button>
  <button onclick="showScreen('diagnosticoScreen')">DIAGNOSTICO</button>
</div>

<script>
function login() {
  const user = document.getElementById("usuario").value.trim();
  const pass = document.getElementById("password").value.trim();

  if (user === "dariza2025" && pass === "dariza2025iot") {

      activarPantallaCompleta(); // <<<<<<<<<< FULL SCREEN

      document.getElementById("loginScreen").style.display = "none";
      document.getElementById("navMenu").style.visibility = "visible";
      showScreen("mainScreen");

  } else {
      document.getElementById("mensaje").innerText = "Credenciales incorrectas";
  }
}

function showScreen(screenId) {
  const screens = [
    "mainScreen",
    "procesoScreen",
    "monitoreoScreen",
    "parametrosScreen",
    "diagnosticoScreen"
  ];

  screens.forEach(id => {
    document.getElementById(id).style.display = "none";
  });

  document.getElementById(screenId).style.display = "flex";
}
function activarPantallaCompleta() {
  const elem = document.documentElement;
  if (elem.requestFullscreen) elem.requestFullscreen();
  else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
  else if (elem.msRequestFullscreen) elem.msRequestFullscreen();
}

</script>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script>
const topicVar = "lurin/factory/bombas/var";
const topicIO  = "lurin/factory/bombas/io";
const client = mqtt.connect("wss://broker.hivemq.com:8884/mqtt");

// ====== SPANS VARIADOR 1 ======
const estadoSpan = document.getElementById("estadoValor");
const potenciaSpan = document.getElementById("potenciaValor");
const corrienteSpan = document.getElementById("corrienteValor");
const voltajeSpan = document.getElementById("voltajeValor");
const frecuenciaSpan = document.getElementById("frecuenciaValor");

// ====== SPANS VARIADOR 2 ======
const estado2Span = document.getElementById("estadoValor2");
const potencia2Span = document.getElementById("potenciaValor2");
const corriente2Span = document.getElementById("corrienteValor2");
const voltaje2Span = document.getElementById("voltajeValor2");
const frecuencia2Span = document.getElementById("frecuenciaValor2");

client.on("connect", () => {
    console.log("Conectado a MQTT");
    client.subscribe(topicVar);
    client.subscribe(topicIO);  // Suscribirse al topic de I/O
});

let sincronizadoProceso = false; // para las frecuencias
let sincronizadoIO = false;      // para H308, H309, H310

client.on("message", (topic, message) => {
    try {
        const data = JSON.parse(message.toString());

        if (topic === topicVar) {
            // ====== VARIADOR 1 ======
            const freq1 = (data.H100 / 100).toFixed(2);
            const volt1 = data.H101.toFixed(0);
            const amp1  = (data.H102 / 100).toFixed(2);
            const pot1  = (data.H103 / 10).toFixed(2);
            const status1 = data.Status1 || "DESCONOCIDO";

            estadoSpan.innerText     = status1;
            potenciaSpan.innerText   = pot1 + " kW";
            corrienteSpan.innerText  = amp1 + " A";
            voltajeSpan.innerText    = volt1 + " V";
            frecuenciaSpan.innerText = freq1 + " Hz";

            // ====== VARIADOR 2 ======
            const freq2 = (data.H200 / 100).toFixed(2);
            const volt2 = data.H201.toFixed(0);
            const amp2  = (data.H202 / 100).toFixed(2);
            const pot2  = (data.H203 / 10).toFixed(2);
            const status2 = data.Status2 || "DESCONOCIDO";

            estado2Span.innerText     = status2;
            potencia2Span.innerText   = pot2 + " kW";
            corriente2Span.innerText  = amp2 + " A";
            voltaje2Span.innerText    = volt2 + " V";
            frecuencia2Span.innerText = freq2 + " Hz";

            // ====== SINCRONIZAR INPUT SOLO UNA VEZ ======
            if (!sincronizadoProceso) {
                const hmi_freq1 = (data.H105 / 100).toFixed(2);
                const hmi_freq2 = (data.H205 / 100).toFixed(2);

                inputFreqProceso.value = hmi_freq1;
                inputFreq2Proceso.value = hmi_freq2;

                sincronizadoProceso = true;

                console.log("üîÑ Sincronizado FRECUENCIAS:", hmi_freq1, hmi_freq2);
            }

        } else if (topic === topicIO) {
            // ====== DIAGNOSTICO RECTANGULOS ======
            const h300 = data.H300;
            const h301 = data.H301;
            const h302 = data.H302;
            const h303 = data.H303;
            const h304 = data.H304;
            const h305 = data.H305;

	function setRectColor(rectId, valor, tanqueImgId) {
   	   const rect = document.getElementById(rectId);
   	   if (!rect) return;

  	   rect.style.backgroundColor = valor ? "green" : "red";

   	   // Mostrar u ocultar imagen del tanque si se pasa el ID
  	   if(tanqueImgId) {
    	     const img = document.getElementById(tanqueImgId);
      	     if(img) img.style.display = valor ? "block" : "none";
    	   }
	}

	// ENTRADAS (tanques)
	setRectColor("rect1", h300, "tanque1Img"); // X0 ‚Üí tanque 1
	setRectColor("rect2", h301, "tanque2Img"); // X1 ‚Üí tanque 2
	setRectColor("rect3", h302, "tanque3Img"); // X2 ‚Üí tanque 3
	setRectColor("rect4", h303);               // X3 ‚Üí solo rect√°ngulo, sin imagen

            // SALIDAS
            setRectColor("rect5", h304);
            setRectColor("rect6", h305);
            // ====== SINCRONIZAR INPUTS H308, H309, H310 SOLO UNA VEZ ======
            if (!sincronizadoIO) {
                const hmi_retardopresion = (data.H308 / 10).toFixed(1);
                const hmi_presionminima  = (data.H309 / 100).toFixed(2);
                const hmi_reintentos     = (data.H310 / 1).toFixed(0);

                inputRetardoPresion.value = hmi_retardopresion;
                inputPresionMinima.value  = hmi_presionminima;
                inputReintentos.value     = hmi_reintentos;

                sincronizadoIO = true;
                console.log("üîÑ Sincronizado I/O:", hmi_retardopresion, hmi_presionminima, hmi_reintentos);
            }
        }

    } catch(e) {
        console.error("Error parseando JSON:", e);
    }
});

</script>

<script>
const topicControl = "lurin/factory/bombas"; 

// === INPUTS EXISTENTES VARIADOR 1 y 2 ===
const inputFreqProceso = document.getElementById("inputFreqProceso");
const inputFreq2Proceso = document.getElementById("inputFreq2Proceso");

// === NUEVOS INPUTS PARAMETROS ===
const inputRetardoPresion = document.getElementById("inputRetardoPresion");
const inputPresionMinima  = document.getElementById("inputPresionMinima");
const inputReintentos = document.getElementById("inputReintentos");

// =======================
//   LIMITES MIENTRAS ESCRIBE
// =======================

// VARIADOR 1 ‚Üí l√≠mite 60
inputFreqProceso.addEventListener("input", () => {
    let v = parseFloat(inputFreqProceso.value);
    if (isNaN(v)) return;
    if (v < 0) inputFreqProceso.value = 0;
    if (v > 60) inputFreqProceso.value = 60;
});

// VARIADOR 2 ‚Üí l√≠mite 50
inputFreq2Proceso.addEventListener("input", () => {
    let v = parseFloat(inputFreq2Proceso.value);
    if (isNaN(v)) return;
    if (v < 0) inputFreq2Proceso.value = 0;
    if (v > 50) inputFreq2Proceso.value = 50;
});

// RETARDO DE PRESI√ìN ‚Üí 0.0‚Äì10.0
inputRetardoPresion.addEventListener("input", () => {
    let v = parseFloat(inputRetardoPresion.value);
    if (isNaN(v)) return;
    if (v < 0.0) inputRetardoPresion.value = 0.0;
    if (v > 10.0) inputRetardoPresion.value = 10.0;
});

// PRESION MINIMA ‚Üí 0.00‚Äì10.00
inputPresionMinima.addEventListener("input", () => {
    let v = parseFloat(inputPresionMinima.value);
    if (isNaN(v)) return;
    if (v < 0.00) inputPresionMinima.value = 0.00;
    if (v > 10.00) inputPresionMinima.value = 10.00;
});

// CANTIDAD REINTENTOS ‚Üí 1‚Äì10
inputReintentos.addEventListener("input", () => {
    let v = parseInt(inputReintentos.value);
    if (isNaN(v)) return;
    if (v < 1) inputReintentos.value = 1;
    if (v > 10) inputReintentos.value = 10;
});

// =======================
//   AL PERDER FOCO ‚Üí FORMATEAR + PUBLICAR MQTT
// =======================

// VARIADOR 1 ‚Üí 0‚Äì60 Hz
inputFreqProceso.addEventListener("blur", () => {
    let v = parseFloat(inputFreqProceso.value);
    if (isNaN(v)) v = 0;

    v = Math.min(60, Math.max(0, v));
    inputFreqProceso.value = v.toFixed(2);

    if (client.connected) {
        const msg = "variador1freq:" + v.toFixed(2);
        client.publish(topicControl, msg);
        console.log("üì§ VAR1 enviado:", msg);
    }
});

// VARIADOR 2 ‚Üí 0‚Äì50 Hz
inputFreq2Proceso.addEventListener("blur", () => {
    let v = parseFloat(inputFreq2Proceso.value);
    if (isNaN(v)) v = 0;

    v = Math.min(50, Math.max(0, v));
    inputFreq2Proceso.value = v.toFixed(2);

    if (client.connected) {
        const msg = "variador2freq:" + v.toFixed(2);
        client.publish(topicControl, msg);
        console.log("üì§ VAR2 enviado:", msg);
    }
});

// RETARDO DE PRESI√ìN ‚Üí 0.0‚Äì10.0
inputRetardoPresion.addEventListener("blur", () => {
    let v = parseFloat(inputRetardoPresion.value);
    if (isNaN(v)) v = 0.0;

    v = Math.min(10.0, Math.max(0.0, v));
    inputRetardoPresion.value = v.toFixed(1);

    if (client.connected) {
        const msg = "retardoPresion:" + v.toFixed(1);
        client.publish(topicControl, msg);
        console.log("üì§ Retardo Presi√≥n enviado:", msg);
    }
});

// PRESION MINIMA ‚Üí 0.00‚Äì10.00
inputPresionMinima.addEventListener("blur", () => {
    let v = parseFloat(inputPresionMinima.value);
    if (isNaN(v)) v = 0.00;

    v = Math.min(10.00, Math.max(0.00, v));
    inputPresionMinima.value = v.toFixed(2);

    if (client.connected) {
        const msg = "presionMinima:" + v.toFixed(2);
        client.publish(topicControl, msg);
        console.log("üì§ Presi√≥n M√≠nima enviado:", msg);
    }
});

// CANTIDAD REINTENTOS ‚Üí 1‚Äì10
inputReintentos.addEventListener("blur", () => {
    let v = parseInt(inputReintentos.value);
    if (isNaN(v)) v = 1;

    v = Math.min(10, Math.max(1, v));
    inputReintentos.value = v;

    if (client.connected) {
        const msg = "cantidadReintentos:" + v;
        client.publish(topicControl, msg);
        console.log("üì§ Cantidad Reintentos enviado:", msg);
    }
});
</script>
</body>
</html>


