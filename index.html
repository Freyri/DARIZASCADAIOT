<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>DARIZA SCADA IOT </title>

<style>
#fullscreenBtn {
  position: fixed;
  top: 15px;
  right: 15px;
  background: transparent;   /* üëà sin fondo */
  color: #0f62fe;            /* üëà solo icono azul */
  border: none;
  font-size: 2rem;           /* üëà icono m√°s bonito */
  cursor: pointer;
  z-index: 9999;
  display: block;
}

body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #fff;
  color: #333;
  height: 100vh;
  overflow: hidden;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* ========= LOGIN ========= */
#loginScreen {
  text-align: center;
}

#loginBox {
  padding: 20px;
  border: 1px solid #ccc;
  border-radius: 12px;
  width: 320px;
  background: #fafafa;
  box-shadow: 0 0 12px rgba(0,0,0,0.15);
  display: flex;
  flex-direction: column;
  align-items: center;
}

#loginLogo {
  width: 320px;
  height: 230px;
  margin-bottom: 15px;
}

#loginLogo img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

#loginBox input {
  width: 100%;
  padding: 10px;
  margin-top: 12px;
  font-size: 1em;
  border-radius: 8px;
  border: 1px solid #bbb;
}

#loginBox button {
  width: 100%;
  margin-top: 18px;
  padding: 10px;
  background: #22a6b3;
  color: white;
  font-size: 1.1em;
  cursor: pointer;
  border: none;
  border-radius: 8px;
  transition: 0.2s;
}
#loginBox button:hover { background: #0984e3; }

/* ========= PANTALLAS ========= */
.screen {
  display: none;
  width: 100%;
  height: 100vh;
  padding-bottom: 90px; /* espacio para el men√∫ */
  box-sizing: border-box;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

/* ========= PANTALLA PRINCIPAL ========= */
#mainScreen {
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
  width: 100%;
  padding-bottom: 90px;
  box-sizing: border-box;
}

#hmiContainer {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100%;
  width: 100%;
}

#logoContainer {
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  padding-top: 20px;
}

#logoContainer img {
  width: 80%;
  height: auto;
  object-fit: contain;
}

/* ========= MEN√ö FIJO ========== */
#navMenu {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: #fff;
  padding: 8px;
  display: flex;
  justify-content: center;
  gap: 25px;
  box-sizing: border-box; /* <<< hace bordes sim√©tricos */
  visibility: hidden; /* OCULTO EN LOGIN */
}

#navMenu button {
  width: calc(19% - 25px); /* 5 botones ‚Üí 20% cada uno */
  padding: 14px 0;
  background: #0f62fe;
  color: white;
  border: none;
  border-radius: 3px;
  font-size: 1.6em;
  font-weight: bold;
  cursor: pointer;
}

#navMenu button:hover {
  background: #3d7dff;
}
/* Botones abajo del tanque */
.tanqueBox button {
  display: block;
  margin-top: 5px;
  width: 90%;  /* ocupa casi todo el ancho del tanque */
}

#esquemaContainer {
  position: relative;
  width: 100%;
  display: flex;
  justify-content: center;
  margin-top: 0%;
}
#esquemaImg {
  width: 95vw;
  max-width: 1500px;
  height: 92vh; /* ‚¨ÖÔ∏è M√ÅS ALTO QUE TU PANTALLA */
  object-fit: fill; /* ‚¨ÖÔ∏è estira sin respetar proporci√≥n */
}
/* === CUADROS CELESTES DIAGN√ìSTICO === */
.diagnosticoBox {
  width: 40vw;                  /* ancho relativo */
  height: 73vh;                 /* alto relativo */
  background: #b5dcff;          /* celeste estilo HMI */
  border: 1px solid #000;       /* borde negro */
  border-radius: 3px;
  box-shadow: 0 0 10px rgba(0,0,0,0.25);
  padding: 15px;
  margin-top: 2.4%;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.diagnosticoTitulo {
  font-size: 2.2vw;
  color: #0040ff;
  font-weight: bold;
  margin-top: 3px;   /* üëà SUBE EL TEXTO */
}
/* RESPONSIVO PARA M√ìVIL */
@media (max-width: 768px) {
  #esquemaImg {
    width: 100vw;      /* ocupa casi toda la pantalla */
    height: 88vh; /* ‚¨ÖÔ∏è M√ÅS ALTO QUE TU PANTALLA */
    max-width: none;
  }
  #esquemaContainer {
    padding-top: 5%;
  }
  #navMenu button {
    font-size: 1em;
    padding: 10px 0;
  }
  .diagnosticoBox {
    width: 35vw;   /* ocupa m√°s ancho en m√≥vil */
    height: 70vh;  /* altura segura */
    margin-top: 12vh;
  }

  .diagnosticoTitulo {
    font-size: 4vw; /* ajusta tama√±o texto */
  }
}

.textoProcesoBox {
  position: absolute;

  display: flex;
  justify-content: center;    /* centra horizontal */
  align-items: center;        /* centra vertical */

  padding: 0.5vw 1vw;

  background: #0f62fe;
  border: 0.15vw solid #0a4ec4;
  border-radius: 0.3vw;

  box-shadow: 0 0 0.6vw rgba(0,0,0,0.25);

  white-space: normal;        /* üëà ahora s√≠ permite multilinea */
  text-align: center;         /* üëà centra cada l√≠nea */
}
.textoProceso {
  font-size: 1.2vw;
  color: white;
  font-weight: bold;
  margin: 0;
}
/* === CUADRO ESPECIAL M√ÅS GRANDE (SOLO PARA PARAMETROS) === */
.textoProcesoBoxGrande {
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;

  padding: 0.5vw 1vw;

  background: #06E3E8;
  border: 1px solid #000000;
  border-radius: 0.5vw;

  box-shadow: 0 0 1vw rgba(0,0,0,0.25);

  white-space: normal;
  text-align: center;

  width: 34vw;   /* üëà M√ÅS ANCHO */
  height: 6vw;   /* üëà M√ÅS ALTO */
}

.textoProcesoGrande {
  font-size: 2vw;  /* üëà LETRA M√ÅS GRANDE */
  color: black;
  font-weight: bold;
  margin: 0;
  line-height: 1.2;
}

.textoProcesoBox2 {
  position: absolute;
  display: flex;
  flex-direction: column;
  justify-content: center;   /* üëà CENTRA verticalmente */
  align-items: flex-start;

  width: 28vw;
  height: 2.4vw;             /* üëà un poquito m√°s alto para que respire */

  padding: 12px 10px;        /* üëà m√°s espacio uniforme arriba/abajo */
  background: #C2F1FA;
  border: 1px solid #000000;
  border-radius: 3px;
  box-shadow: 0 0 6px rgba(0,0,0,0.25);
}


.textoProceso2 {
  font-size: 1.2vw;
  color: black;
  text-align: left;
  font-weight: bold;
  margin: 0;

  display: flex;
  justify-content: space-between; 
  width: 96%; /* Ajusta la separaci√≥n autom√°ticamente */
}
/* ===== CUADRO TRANSPARENTE SOLO TEXTO ===== */
.textoProcesoBoxTransparente {
  position: absolute;
  display: flex;
  justify-content: left;
  align-items: center;

  padding: 0.5vw 1vw;

  background: transparent;      /* SIN FONDO */
  border: none;                 /* SIN BORDE */
  box-shadow: none;             /* SIN SOMBRA */

  white-space: normal;
  text-align: left;

  width: 34vw;                  /* igual que textoProcesoBoxGrande */
  height: 6vw;                  /* igual que textoProcesoBoxGrande */
}

.textoProcesoTransparente {
  font-size: 2vw;               /* igual que textoProcesoGrande */
  color: black;                 /* color del texto */
  font-weight: bold;
  margin: 0;
  line-height: 1.2;
}
/* Quitar flechas de los inputs type=number */
input::-webkit-outer-spin-button,
input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}
input[type=number] {
    -moz-appearance: textfield; /* Firefox */
}

</style>
</head>
<body>
<button id="fullscreenBtn" onclick="activarPantallaCompleta()">‚õ∂</button>
<!-- ========== LOGIN ========== -->
<div id="loginScreen">
  <div id="loginBox">
    <div id="loginLogo">
      <img src="logo.jpg" alt="Logo" />
    </div>

    <h2>Ingresar</h2>
    <input id="usuario" type="text" placeholder="Usuario">
    <input id="password" type="password" placeholder="Contrase√±a">
    <button onclick="login()">Entrar</button>
    <p id="mensaje" style="color:red; margin-top:10px;"></p>
  </div>
</div>

<!-- ========== PANTALLA PRINCIPAL ========== -->
<div id="mainScreen" class="screen">
  <div id="hmiContainer">
    <div id="logoContainer">
      <img src="logo.jpg" alt="LOGO">
    </div>
  </div>
</div>

<!-- ========== OTRAS PANTALLAS ========== -->

<div id="procesoScreen" class="screen">
  <!-- IM√ÅGENES EST√ÅTICAS -->
  <div id="esquemaContainer">
      <img src="esquema.PNG" id="esquemaImg">
  </div>

  <!-- CUADRO DE TEXTO -->

  <div class="textoProcesoBox" style="top: 43%; left: 24%;">
      <p class="textoProceso">MODO DE TRABAJO</p>
  </div>

  <div class="textoProcesoBox" style="top: 43%; left: 76%;">
      <p class="textoProceso">BOMBA DE SUMINISTRO</p>
  </div>
</div>
<div id="monitoreoScreen" class="screen">
  <!-- TITULOS DE VARIADORES -->
  <div class="textoProcesoBox" style="top: 3%; left: 16%;">
     <p class="textoProceso">VARIADOR DE BOMBA<br>SUMERGIBLE</p>
  </div>

  <div class="textoProcesoBox" style="top: 3%; left: 67.9%;">
     <p class="textoProceso">VARIADOR DE BOMBAS<br>DE SUMINISTRO</p>
  </div>

  <!-- PRIMER BLOQUE DE MONITOREO -->
  <div class="textoProcesoBox2" style="top: 14%; left: 8.8%;">
     <p class="textoProceso2">
       <span>ESTADO:</span>
       <span id="estadoValor">DESCONOCIDO</span>
     </p>
  </div>

  <div class="textoProcesoBox2" style="top: 26%; left: 8.8%;">
    <p class="textoProceso2">
      <span>POTENCIA:</span>
      <span id="potenciaValor">KW</span>
    </p>
  </div>

  <div class="textoProcesoBox2" style="top: 38%; left: 8.8%;">
    <p class="textoProceso2">
      <span>CORRIENTE:</span>
      <span id="corrienteValor">A</span>
    </p>
  </div>

  <div class="textoProcesoBox2" style="top: 50%; left: 8.8%;">
    <p class="textoProceso2">
      <span>VOLTAJE:</span>
      <span id="voltajeValor">V</span>
    </p>
  </div>

  <div class="textoProcesoBox2" style="top: 62%; left: 8.8%;">
    <p class="textoProceso2">
      <span>FRECUENCIA:</span>
      <span id="frecuenciaValor">HZ</span>
    </p>
  </div>

  <!-- SEGUNDO BLOQUE DE MONITOREO (SI QUIERES) -->
  <div class="textoProcesoBox2" style="top: 14%; left: 60.8%;">
     <p class="textoProceso2">
       <span>ESTADO:</span>
       <span id="estadoValor2">DESCONOCIDO</span>
     </p>
  </div>

  <div class="textoProcesoBox2" style="top: 26%; left: 60.8%;">
    <p class="textoProceso2">
      <span>POTENCIA:</span>
      <span id="potenciaValor2">%</span>
    </p>
  </div>

  <div class="textoProcesoBox2" style="top: 38%; left: 60.8%;">
    <p class="textoProceso2">
      <span>CORRIENTE:</span>
      <span id="corrienteValor2">A</span>
    </p>
  </div>

  <div class="textoProcesoBox2" style="top: 50%; left: 60.8%;">
    <p class="textoProceso2">
      <span>VOLTAJE:</span>
      <span id="voltajeValor2">V</span>
    </p>
  </div>

  <div class="textoProcesoBox2" style="top: 62%; left: 60.8%;">
    <p class="textoProceso2">
      <span>FRECUENCIA:</span>
      <span id="frecuenciaValor2">HZ</span>
    </p>
  </div>
  <div class="textoProcesoBox2" style="top: 74%; left: 8.8%; background: yellow; border: 1px solid #000;">
   <input id="inputFreqProceso" type="number" min="0" max="60" step="0.01"
           style="width: 100%; height: 100%; font-size:1.2vw; font-weight:bold; text-align:center; border:none; background: yellow; -moz-appearance:textfield; -webkit-appearance:none;">
  </div>
  <div class="textoProcesoBoxTransparente" style="top: 74%; left: 32%;">
     <p class="textoProcesoTransparente">HZ</p>
   </div>
</div>

<div id="parametrosScreen" class="screen">
  <div class="textoProcesoBoxGrande" style="top: 15%; left: 20%;">
       <p class="textoProcesoGrande">RETARDO DE TOLERANCIA<br>DE GARANT√çA DE PRESI√ìN</p>
  </div>
  <div class="textoProcesoBoxGrande" style="top: 40%; left: 20%;">
       <p class="textoProcesoGrande">PRESI√ìN M√çNIMA DE<br>SUMINISTRO</p>
  </div>
  <div class="textoProcesoBoxGrande" style="top: 65%; left: 20%;">
       <p class="textoProcesoGrande">CANTIDAD DE REINTENTOS<br>POR FALTA DE PRESI√ìN</p>
  </div>
</div>

<div id="diagnosticoScreen" class="screen" 
     style="flex-direction: row; justify-content: center; gap: 4vw;">

  <div class="diagnosticoBox">
     <p class="diagnosticoTitulo">ENTRADAS</p>
     <div class="textoProcesoBoxTransparente" style="top: 17%; left: 16%;">
       <p class="textoProcesoTransparente">BOYA 1</p>
     </div>
     <div class="textoProcesoBoxTransparente" style="top: 34%; left: 16%;">
       <p class="textoProcesoTransparente">BOYA 2</p>
     </div>
     <div class="textoProcesoBoxTransparente" style="top: 51%; left: 16%;">
       <p class="textoProcesoTransparente">SOLICITUD (BOYA 3)</p>
     </div>
     <div class="textoProcesoBoxTransparente" style="top: 68%; left: 16%;">
       <p class="textoProcesoTransparente">PARADA DE EMERGENCIA</p>
     </div>
  </div>

  <div class="diagnosticoBox">
     <p class="diagnosticoTitulo">SALIDAS</p>
     <div class="textoProcesoBoxTransparente" style="top: 17%; left: 60%;">
       <p class="textoProcesoTransparente">BOMBA IZQUIERDA</p>
     </div>
     <div class="textoProcesoBoxTransparente" style="top: 34%; left: 60%;">
       <p class="textoProcesoTransparente">BOMBA DERECHA</p>
     </div>
  </div>

</div>


<!-- ========== MEN√ö FIJO ========== -->
<div id="navMenu">
  <button onclick="showScreen('mainScreen')">PRINCIPAL</button>
  <button onclick="showScreen('procesoScreen')">PROCESO</button>
  <button onclick="showScreen('monitoreoScreen')">MONITOREO</button>
  <button onclick="showScreen('parametrosScreen')">PARAMETROS</button>
  <button onclick="showScreen('diagnosticoScreen')">DIAGNOSTICO</button>
</div>

<script>
function login() {
  const user = document.getElementById("usuario").value.trim();
  const pass = document.getElementById("password").value.trim();

  if (user === "dariza2025" && pass === "dariza2025iot") {

      activarPantallaCompleta(); // <<<<<<<<<< FULL SCREEN

      document.getElementById("loginScreen").style.display = "none";
      document.getElementById("navMenu").style.visibility = "visible";
      showScreen("mainScreen");

  } else {
      document.getElementById("mensaje").innerText = "Credenciales incorrectas";
  }
}

function showScreen(screenId) {
  const screens = [
    "mainScreen",
    "procesoScreen",
    "monitoreoScreen",
    "parametrosScreen",
    "diagnosticoScreen"
  ];

  screens.forEach(id => {
    document.getElementById(id).style.display = "none";
  });

  document.getElementById(screenId).style.display = "flex";
}
function llenarTanque(num) {
  document.getElementById("tanque" + num + "Img").src = "lleno.PNG";
}

function vaciarTanque(num) {
  document.getElementById("tanque" + num + "Img").src = "vacio.PNG";
}
function activarPantallaCompleta() {
  const elem = document.documentElement;
  if (elem.requestFullscreen) elem.requestFullscreen();
  else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
  else if (elem.msRequestFullscreen) elem.msRequestFullscreen();
}

</script>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script>
const topicStatus  = "lurin/factory/bombas/status"; 
const client = mqtt.connect("wss://broker.hivemq.com:8884/mqtt");

// IDs de los spans
const estadoSpan = document.getElementById("estadoValor");
const potenciaSpan = document.getElementById("potenciaValor");
const corrienteSpan = document.getElementById("corrienteValor");
const voltajeSpan = document.getElementById("voltajeValor");
const frecuenciaSpan = document.getElementById("frecuenciaValor");

client.on("connect", () => {
  console.log("Conectado a MQTT");
  client.subscribe(topicStatus);
});

client.on("message", (topic, message) => {
  try {
    const data = JSON.parse(message.toString());

    const freq = (data.H100 / 100).toFixed(2);
    const volt = data.H101.toFixed(0);
    const amp  = (data.H102 / 100).toFixed(2);
    const pot  = (data.H103 / 10).toFixed(2);
    const status = data.Status || "DESCONOCIDO";

    // Actualizar los valores en pantalla
    estadoSpan.innerText = status;
    potenciaSpan.innerText = pot + " kW";
    corrienteSpan.innerText = amp + " A";
    voltajeSpan.innerText = volt + " V";
    frecuenciaSpan.innerText = freq + " Hz";

  } catch(e) {
    console.error("Error parseando JSON:", e);
  }
});
</script>
<script>
const topicControl = "lurin/factory/bombas"; 
const inputFreqProceso = document.getElementById("inputFreqProceso");
// Formatear siempre a 2 decimales al perder foco
inputFreqProceso.addEventListener("blur", () => {
    let valor = parseFloat(inputFreqProceso.value);
    if (isNaN(valor)) valor = 0;
    valor = Math.min(60, Math.max(0, valor)); // limita entre 0 y 60
    inputFreqProceso.value = valor.toFixed(2); // siempre 2 decimales
});

let sincronizadoProceso = false; // solo sincroniza 1 vez

// MQTT ya lo tienes conectado con 'client'
client.on("message", (topic, message) => {
  try {
    const data = JSON.parse(message.toString());

    // Solo sincroniza 1 vez al entrar a proceso
    const hmi_freq = (data.H105 / 100).toFixed(2);
    if (!sincronizadoProceso) {
        sincronizadoProceso = true;
        inputFreqProceso.value = hmi_freq;
        console.log("üîÑ Sincronizado FRECUENCIA PROCESO:", hmi_freq, "Hz");
    }

  } catch(e) {
    console.error("Error parseando JSON proceso:", e);
  }
});

inputFreqProceso.addEventListener("input", () => {
    let valor = parseFloat(inputFreqProceso.value);
    if(isNaN(valor)) valor = 0;
    valor = Math.min(60, Math.max(0, valor));
    inputFreqProceso.value = valor.toFixed(2);

    if(client.connected) client.publish(topicControl, valor.toFixed(2));
});

</script>
</body>
</html>

